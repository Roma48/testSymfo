{% extends '::base.html.twig' %}

{% block body %}

    <!-- Modal for create new client -->
    <div class="modal fade" id="addRecommendationModal" tabindex="-1" role="dialog" aria-labelledby="addRecommendationModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel">Додати рекомендації:</h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Назад</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <h3>
                {{ event.title }}
                <div class="pull-right">
                    <a href="{{ path('cto_jobs_home') }}" class="btn btn-sm btn-default"><i class="fa fa-arrow-left"></i>&nbsp;&nbsp;&nbsp;Назад</a>
                </div>
            </h3>
            <br>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <h4><u>Загальна інформація про клієнта:</u></h4>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Ім'я: </span>{{ event.client.firstName }}&nbsp;&nbsp;(<a href="{{ path('cto_client_show', {"slug": event.client.slug }) }}">Профайл кліента</a>)</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Прізвище: </span>{{ event.client.lastName }}</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Кількість автомобілів: </span>{{ event.client.cars | length }}</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Дата останнього візиту: </span>{{ event.client.lastVisitDate | date("d.m.Y") }}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <h4><u>Подія:</u></h4>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Дата: </span>{{ event.startAt | date("d.m.Y H:m") }} - {{ event.endAt | date("d.m.Y H:m") }}</p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Автомобіль: </span>
            {% if event.car.model is defined%}
                {{ event.car.model.name }}
            {% endif %}
            </p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Номер автомобіля: </span>
                {% if event.car.carNumber is defined %}
                    {{ event.car.carNumber }}
                {% endif %}
            </p>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="font-bolder">Опис події: </span>{{ event.message }}</p>
     </div>
    </div>

{% endblock %}

{% block javascripts %}
<script>
    jQuery(function ($) {

        var recommendationForm = $("#addRecommendationForm");
//        recommendationForm.on('submit', function(e) {
//            e.preventDefault();
//        });

        var addRecommendationsBtn = $("#addRecommendationButton");
        var modal = $("#addRecommendationModal");
        var recommendationForm_Errors = $("#addRecommendationForm_Errors");

        var $collectionHolder;
        var $addTagLink = $('<br><a href="#" class="bnt btn-sm btn-info">Додати рекомендацію</a>');
        var $newLinkLi = $('<li></li>').append($addTagLink);

        $collectionHolder = $('#recommendations_collection ul.recommendations-ul');
        $collectionHolder.append($newLinkLi);
        $collectionHolder.data('index', $collectionHolder.find(':input').length);
        $collectionHolder.find('li').each(function() {
            addCarFormDeleteLink($(this));
        });
        $addTagLink.on('click', function(e) {
            e.preventDefault();
            addCarForm($collectionHolder, $newLinkLi);
        });

        function addCarFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<a href="#" class="btn btn-xs btn-danger delete-except-date">Видалити</a>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function(e) {
                e.preventDefault();
                $tagFormLi.remove();
            });
        }

        function addCarForm($collectionHolder, $newLinkLi) {
            var prototype = $collectionHolder.data('prototype');
            var index = $collectionHolder.data('index');
            var newForm = prototype.replace(/__name__/g, index);
            $collectionHolder.data('index', index + 1);
            var $newFormLi = $('<li></li>').append(newForm);
            $newLinkLi.before($newFormLi);

            addCarFormDeleteLink($newFormLi);
        }

        addRecommendationsBtn.click(function(e){
            e.preventDefault();

            modal.modal('show');
        });

        $("#addRecommendationSubmit").click(function(){

            if (($collectionHolder.find('li').length - 1) == 0) {
                recommendationForm_Errors.html('Необхідно додати мінімум одну рекомендацію');
            } else {
                recommendationForm_Errors.html('');

                // OK and submit form
                recommendationForm.submit();
            }
        });
    });
</script>

{% endblock javascripts %}